/*! Version: 0.88.0
Copyright (c) 2016 Dominik Moritz */

!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports,require("leaflet")):"function"==typeof define&&define.amd?define(["exports","leaflet"],i):i(((t="undefined"!=typeof globalThis?globalThis:t||self).L=t.L||{},t.L.Control=t.L.Control||{},t.L.Control.Locate={}),t.L)}(this,function(t,i){"use strict";const o=3.2808399;function s(t,i){i.split(" ").forEach(i=>{t.classList.add(i)})}function e(t,i){i.split(" ").forEach(i=>{t.classList.remove(i)})}const n=i.Marker.extend({initialize(t,o){i.setOptions(this,o),this._latlng=t,this.createIcon()},createIcon(){const t=this.options,o=[["stroke",t.color],["stroke-width",t.weight],["fill",t.fillColor],["fill-opacity",t.fillOpacity],["opacity",t.opacity]].filter(([,t])=>void 0!==t).map(([t,i])=>`${t}="${i}"`).join(" "),s=this._getIconSVG(t,o);this._locationIcon=i.divIcon({className:s.className,html:s.svg,iconSize:[s.w,s.h]}),this.setIcon(this._locationIcon)},_getIconSVG(t,i){const o=t.radius,s=o+t.weight,e=2*s;return{className:"leaflet-control-locate-location",svg:`<svg xmlns="http://www.w3.org/2000/svg" width="${e}" height="${e}" version="1.1" viewBox="-${s} -${s} ${e} ${e}"><circle r="${o}" ${i} /></svg>`,w:e,h:e}},setStyle(t){i.setOptions(this,t),this.createIcon()}}),a=n.extend({initialize(t,o,s){i.setOptions(this,s),this._latlng=t,this._heading=o,this.createIcon()},setHeading(t){this._heading=t},_getIconSVG(t,i){const o=t.radius,s=o+t.weight+t.depth,e=2*s;return{className:"leaflet-control-locate-heading",svg:`<svg xmlns="http://www.w3.org/2000/svg" width="${e}" height="${e}" version="1.1" viewBox="-${s} -${s} ${e} ${e}"><path d="${this._arrowPoints(o,t.width,t.depth,this._heading)}" ${i} /></svg>`,w:e,h:e}},_arrowPoints(t,i,o,s){const e=(s-90)*Math.PI/180,n=Math.cos(e),a=Math.sin(e),r=-Math.sin(e),l=Math.cos(e),h=i/2,c=t*n,_=t*a;return`M ${c+h*r},${_+h*l} L ${c-h*r},${_-h*l} L ${c+o*n},${_+o*a} Z`}}),r=i.Control.extend({options:{position:"topleft",layer:void 0,setView:"untilPanOrZoom",keepCurrentZoomLevel:!1,initialZoomLevel:!1,getLocationBounds:t=>t.bounds,flyTo:!1,clickBehavior:{inView:"stop",outOfView:"setView",inViewNotFollowing:"inView"},returnToPrevBounds:!1,cacheLocation:!0,drawCircle:!0,drawMarker:!0,showCompass:!0,markerClass:n,compassClass:a,circleStyle:{className:"leaflet-control-locate-circle",color:"#136AEC",fillColor:"#136AEC",fillOpacity:.15,weight:0},markerStyle:{className:"leaflet-control-locate-marker",color:"#fff",fillColor:"#2A93EE",fillOpacity:1,weight:3,opacity:1,radius:9},compassStyle:{fillColor:"#2A93EE",fillOpacity:1,weight:0,color:"#fff",opacity:1,radius:9,width:9,depth:6},followCircleStyle:{},followMarkerStyle:{},followCompassStyle:{},icon:"leaflet-control-locate-location-arrow",iconLoading:"leaflet-control-locate-spinner",iconElementTag:"span",textElementTag:"small",circlePadding:[0,0],metric:!0,createButtonCallback(t,o){const s=i.DomUtil.create("a","leaflet-bar-part leaflet-bar-part-single",t);s.title=o.strings.title,s.href="#",s.setAttribute("role","button"),s.setAttribute("aria-label",o.strings.title);const e=i.DomUtil.create(o.iconElementTag,o.icon,s);if(e.classList.add("leaflet-locate-icon"),void 0!==o.strings.text){i.DomUtil.create(o.textElementTag,"leaflet-locate-text",s).textContent=o.strings.text,s.classList.add("leaflet-locate-text-active"),s.parentNode.style.display="flex"}return{link:s,icon:e}},onLocationError(t){alert(t.message)},onLocationOutsideMapBounds(t){t.stop(),alert(t.options.strings.outsideMapBoundsMsg)},showPopup:!0,strings:{title:"Show me where I am",metersUnit:"meters",feetUnit:"feet",popup:"You are within {distance} {unit} from this point",outsideMapBoundsMsg:"You seem located outside the boundaries of the map"},locateOptions:{maxZoom:1/0,watch:!0,setView:!1}},initialize(t={}){this.options=function(t){const i={};for(const o in t){const s=t[o];Array.isArray(s)?i[o]=[...s]:i[o]=s?.constructor===Object?{...s}:s}return i}(this.options);for(const i in t){const o=t[i],s=this.options[i];o?.constructor===Object&&s?.constructor===Object?Object.assign(s,o):this.options[i]=o}Object.assign(this.options.followMarkerStyle,this.options.markerStyle,this.options.followMarkerStyle),Object.assign(this.options.followCircleStyle,this.options.circleStyle,this.options.followCircleStyle),Object.assign(this.options.followCompassStyle,this.options.compassStyle,this.options.followCompassStyle)},onAdd(t){const o=i.DomUtil.create("div","leaflet-control-locate leaflet-bar leaflet-control");this._container=o,this._map=t,this._layer=this.options.layer||new i.LayerGroup,this._layer.addTo(t),this._event=void 0,this._compassHeading=null,this._prevBounds=null;const s=this.options.createButtonCallback(o,this.options);return this._link=s.link,this._icon=s.icon,i.DomEvent.on(this._link,"click",function(t){i.DomEvent.stopPropagation(t),i.DomEvent.preventDefault(t),this._onClick()},this).on(this._link,"dblclick",i.DomEvent.stopPropagation),this._resetVariables(),this._map.on("unload",this._unload,this),o},onRemove(){this.stop()},_onClick(){this._justClicked=!0;const t=this._isFollowing();if(this._userPanned=!1,this._userZoomed=!1,this._active&&!this._event)this.stop();else if(this._active){const i=this.options.clickBehavior;let o=i.outOfView;switch(this._map.getBounds().contains(this._event.latlng)&&(o=t?i.inView:i.inViewNotFollowing),i[o]&&(o=i[o]),o){case"setView":this.setView();break;case"stop":if(this.stop(),this.options.returnToPrevBounds){(this.options.flyTo?this._map.flyToBounds:this._map.fitBounds).bind(this._map)(this._prevBounds)}}}else this.options.returnToPrevBounds&&(this._prevBounds=this._map.getBounds()),this.start();this._updateContainerStyle()},start(){this._activate(),this._event&&(this._drawMarker(this._map),this.options.setView&&this.setView()),this._updateContainerStyle()},stop(){this._deactivate(),this._cleanClasses(),this._resetVariables(),this._removeMarker()},stopFollowing(){this._userPanned=!0,this._updateContainerStyle(),this._drawMarker()},_activate(){if(!this._active&&this._map&&(this._map.locate(this.options.locateOptions),this._map.fire("locateactivate",this),this._active=!0,this._map.on("locationfound",this._onLocationFound,this),this._map.on("locationerror",this._onLocationError,this),this._map.on("dragstart",this._onDrag,this),this._map.on("zoomstart",this._onZoom,this),this._map.on("zoomend",this._onZoomEnd,this),this.options.showCompass)){const t="ondeviceorientationabsolute"in window;if(t||"ondeviceorientation"in window){const o=this,s=function(){i.DomEvent.on(window,t?"deviceorientationabsolute":"deviceorientation",o._onDeviceOrientation,o)};DeviceOrientationEvent&&"function"==typeof DeviceOrientationEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(function(t){"granted"===t&&s()}):s()}}},_deactivate(){this._active&&this._map&&(this._map.stopLocate(),this._map.fire("locatedeactivate",this),this._active=!1,this.options.cacheLocation||(this._event=void 0),this._map.off("locationfound",this._onLocationFound,this),this._map.off("locationerror",this._onLocationError,this),this._map.off("dragstart",this._onDrag,this),this._map.off("zoomstart",this._onZoom,this),this._map.off("zoomend",this._onZoomEnd,this),this.options.showCompass&&(this._compassHeading=null,"ondeviceorientationabsolute"in window?i.DomEvent.off(window,"deviceorientationabsolute",this._onDeviceOrientation,this):"ondeviceorientation"in window&&i.DomEvent.off(window,"deviceorientation",this._onDeviceOrientation,this)))},_shouldKeepCurrentZoom(){const t=this.options.keepCurrentZoomLevel;if(Array.isArray(t)&&2===t.length){const i=this._map.getZoom(),[o,s]=t;return i>=o&&i<=s}return!0===t},setView(){if(this._drawMarker(),this._isOutsideMapBounds())return this._event=void 0,void this.options.onLocationOutsideMapBounds(this);const{latlng:t}=this._event,i=this.options.flyTo;let o,s;this._justClicked&&!1!==this.options.initialZoomLevel?(o=i?"flyTo":"setView",s=[t,this.options.initialZoomLevel]):this._shouldKeepCurrentZoom()?(o=i?"flyTo":"panTo",s=[t]):(o=i?"flyToBounds":"fitBounds",s=[this.options.getLocationBounds(this._event),{padding:this.options.circlePadding,maxZoom:this.options.locateOptions.maxZoom}]),this._setViewIgnoringEvents(o,s)},_setViewIgnoringEvents(t,i){this._ignoreEvent=!0,this._map[t](...i),requestAnimationFrame(()=>{this._ignoreEvent=!1})},_drawCompass(){if(!this._event)return;const t=this._event.latlng;if(this.options.showCompass&&t&&null!==this._compassHeading){const i=this._isFollowing()?this.options.followCompassStyle:this.options.compassStyle;this._compass?(this._compass.setLatLng(t),this._compass.setHeading(this._compassHeading),this._compass.setStyle&&this._compass.setStyle(i)):this._compass=new this.options.compassClass(t,this._compassHeading,i).addTo(this._layer)}!this._compass||this.options.showCompass&&null!==this._compassHeading||(this._compass.removeFrom(this._layer),this._compass=null)},_drawMarker(){if(!this._event)return;const t=this._event.latlng,o=this._event.accuracy??0,s=this._isFollowing();if(this.options.drawCircle){const e=s?this.options.followCircleStyle:this.options.circleStyle;if(this._circle)this._circle.setLatLng(t).setRadius(o).setStyle(e);else{const s=Object.assign({},e,{radius:o});this._circle=new i.Circle(t,s).addTo(this._layer)}}if(this.options.drawMarker){const i=s?this.options.followMarkerStyle:this.options.markerStyle;this._marker?(this._marker.setLatLng(t),this._marker.setStyle&&this._marker.setStyle(i)):this._marker=new this.options.markerClass(t,i).addTo(this._layer)}this._drawCompass(),this._bindPopup(t,o)},_bindPopup(t,s){const e=this.options.strings.popup;if(!this.options.showPopup||!e)return;let n,a,r;this.options.metric?(n=s.toFixed(0),a=this.options.strings.metersUnit,r=null!=this._event?.altitude?this._event.altitude.toFixed(1):"N/A"):(n=(s*o).toFixed(0),a=this.options.strings.feetUnit,r=null!=this._event?.altitude?(this._event.altitude*o).toFixed(1):"N/A");const l={distance:n,unit:a,lat:t.lat.toFixed(6),lng:t.lng.toFixed(6),altitude:r};let h;h="string"==typeof e?i.Util.template(e,l):"function"==typeof e?e(l):e,this._marker&&this._marker.bindPopup(h)._popup.setLatLng(t),this._compass&&this._compass.bindPopup(h)._popup.setLatLng(t)},_removeMarker(){this._layer.clearLayers(),this._marker=void 0,this._circle=void 0,this._compass=void 0},_unload(){this.stop(),this._map&&this._map.off("unload",this._unload,this)},_setCompassHeading(t){Number.isFinite(t)?(this._compassHeading=Math.round(t),requestAnimationFrame(()=>this._drawCompass())):(this._compassHeading=null,this._drawCompass())},_onCompassNeedsCalibration(){this._setCompassHeading()},_onDeviceOrientation(t){this._active&&(t.webkitCompassHeading?this._setCompassHeading(t.webkitCompassHeading):t.absolute&&t.alpha&&this._setCompassHeading(360-t.alpha))},_onLocationError(t){if(3===t.code&&this.options.locateOptions.watch)return this._timeoutCount=(this._timeoutCount||0)+1,this._map.fire("locationtimeout",{error:t,control:this,count:this._timeoutCount}),void(this._timeoutCount>=3&&this._container&&s(this._container,"locate-timeout"));this._timeoutCount=0,this.stop(),this.options.onLocationError(t,this)},_onLocationFound(t){if((this._event?.latlng?.lat!==t.latlng.lat||this._event?.latlng?.lng!==t.latlng.lng||this._event?.accuracy!==t.accuracy)&&this._active){switch(this._timeoutCount=0,this._container&&e(this._container,"locate-timeout"),this._event=t,this._drawMarker(),this._updateContainerStyle(),this._map.fire("locatelocationfound",{...t,control:this}),this.options.setView){case"once":this._justClicked&&this.setView();break;case"untilPan":this._userPanned||this.setView();break;case"untilPanOrZoom":this._userPanned||this._userZoomed||this.setView();break;case"always":this.setView()}this._justClicked=!1}},_onDrag(){this._event&&!this._ignoreEvent&&(this._userPanned=!0,this._updateContainerStyle(),this._drawMarker())},_onZoom(){this._event&&!this._ignoreEvent&&(this._userZoomed=!0,this._updateContainerStyle(),this._drawMarker())},_onZoomEnd(){this._event&&this._drawCompass(),this._event&&!this._ignoreEvent&&this._marker&&!this._map.getBounds().pad(-.3).contains(this._marker.getLatLng())&&(this._userPanned=!0,this._updateContainerStyle(),this._drawMarker())},_isFollowing(){return!!this._active&&("always"===this.options.setView||("untilPan"===this.options.setView?!this._userPanned:"untilPanOrZoom"===this.options.setView&&(!this._userPanned&&!this._userZoomed)))},_isOutsideMapBounds(){return void 0!==this._event&&(this._map.options.maxBounds&&!this._map.options.maxBounds.contains(this._event.latlng))},_updateContainerStyle(){this._container&&(this._active&&!this._event?this._setClasses("requesting"):this._isFollowing()?this._setClasses("following"):this._active?this._setClasses("active"):this._cleanClasses())},_setClasses(t){switch(t){case"requesting":e(this._container,"active following"),s(this._container,"requesting"),e(this._icon,this.options.icon),s(this._icon,this.options.iconLoading);break;case"active":e(this._container,"requesting following"),s(this._container,"active"),e(this._icon,this.options.iconLoading),s(this._icon,this.options.icon);break;case"following":e(this._container,"requesting"),s(this._container,"active following"),e(this._icon,this.options.iconLoading),s(this._icon,this.options.icon)}},_cleanClasses(){i.DomUtil.removeClass(this._container,"requesting"),i.DomUtil.removeClass(this._container,"active"),i.DomUtil.removeClass(this._container,"following"),e(this._icon,this.options.iconLoading),s(this._icon,this.options.icon)},_resetVariables(){this._active=!1,this._justClicked=!1,this._timeoutCount=0,this._container&&e(this._container,"locate-timeout"),this._userPanned=!1,this._userZoomed=!1}});t.CompassMarker=a,t.LocateControl=r,t.LocationMarker=n,t.locate=function(t){return new r(t)},Object.defineProperty(t,"__esModule",{value:!0})}),"undefined"!=typeof window&&window.L&&(window.L.control=window.L.control||{},window.L.control.locate=window.L.Control.Locate.locate);
//# sourceMappingURL=L.Control.Locate.min.js.map
